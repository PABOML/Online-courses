---
title: "Regression Exercise"
output: 
  html_document:
    toc: true
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Data Understanding

You will work on airfoil self noise prediction. Data comes from NASA airfoil testing. Airfoil blade sections were tested with regards to sound emission.

These are the independent variables:

- Frequency, in Hertzs. 

- Angle of attack, in degrees. 

- Chord length, in meters. 

- Free-stream velocity, in meters per second. 

- Suction side displacement thickness, in meters. 

The target variable is 

- Scaled sound pressure level, in decibels. 

```{r}
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(corrplot))
suppressPackageStartupMessages(library(keras))
suppressPackageStartupMessages(library(caret))

source('./train_val_test_split.R')
```


# Data Preparation

```{r}
# if file does not exist, download it first
file_path <- "./data/airfoil_noise.txt"
if (!file.exists(file_path)) {
  dir.create("./data")
  url <- "https://archive.ics.uci.edu/ml/machine-learning-databases/00291/airfoil_self_noise.dat"
  download.file(url = url, 
                destfile = file_path)
}
```

Import the data and assign it to object *airfoil_noise*:

```{r}
airfoil_noise <- read.delim('./data/airfoil_noise.txt', header=F)
```


Assign the right column names. Please use these names:

frequency, aoa, chord_length, free_stream_vel, ss_displacement_thickness, spl)


```{r}
column_names <- c('frequency', 'aoa', 'chord_length', 'free_stream_vel', 'ss_displacement_thickness', 'spl')
colnames(airfoil_noise) <- column_names
airfoil_noise %>% head()
```

## Exploratory data analysis

Create a correlation plot for the data to understand which variables are most valuable to predict sound pressure level.

```{r}
airfoil_noise_scaled <- airfoil_noise %>%
  scale()%>%
  as_tibble()

corr_an <- cor(airfoil_noise_scaled)
corrplot(corr_an, method='circle')
```

Which two variables correlate most to target variable?

```{r}
# The frequency and the suction side displacement thickness (ss_displacement_thickness).
```

## Train / Validation / Test Split

Divide your dataset into a training, validation, and test set.

Use these ratios: 80 % train, 20 % validation, 0 % testing

```{r}
set.seed(123)
c(train, val, test) %<-% train_val_test_split(airfoil_noise_scaled, train_ratio =0.8, val_ratio = 0.2, test_ratio = 0)
```

# Model1

## Model Creation

Create a multivariate linear regression model based on training data.

```{r}
model <- lm(data=train,
            formula = spl ~ .)
```

## Model Performance

Analyse model performance (based on training and validation dataset) and get R**2 value:

```{r}
val$spl_prediction <- predict(object = model, 
                                  newdata = val)

R2(pred=val$spl_prediction,
   obs=val$spl)

summary(model)
```

Does the model overfit?

# Model2

## Model Creation

Create a second model with only three independent variables. Which ones do you choose? What is the R**2 for this model?

Create a second model with only three independent variables. Which ones do you choose? 

```{r}
model2 <- lm(data=train,
            formula=spl ~ frequency + ss_displacement_thickness + chord_length)

val$spl_prediction_2 <- predict(object = model2, 
                                  newdata = val)

```

## Model Performance

Analyse model performance (based on training and validation dataset) and get R**2 value:

```{r}
R2(pred=val$spl_prediction_2,
   obs=val$spl)

summary(model2)
```

Did the model performance increase?

```{r}
#No, it went from ~ 0.52 down to ~0.47 on the test set. Model2 produced lower R**2 than model 1.
```


# Acknowledgement

This dataset comes from UCI Machine Learning Repository. Here is more information on donor and creators of the data.

Donor: 
Dr Roberto Lopez 
robertolopez '@' intelnics.com 
Intelnics 

Creators: 
Thomas F. Brooks, D. Stuart Pope and Michael A. Marcolini 
NASA